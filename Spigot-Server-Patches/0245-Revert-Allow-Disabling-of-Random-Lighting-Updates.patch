From df9aed350cfb8093d98cd216946c94b5f8dfec8b Mon Sep 17 00:00:00 2001
From: Shane Freeder <theboyetronic@gmail.com>
Date: Tue, 31 Oct 2017 20:52:11 -0400
Subject: [PATCH] Revert "Allow Disabling of Random Lighting Updates"

This patch by Spigot allows the disabling of chunks to be lit as they're ticked by server
operators, the side effects of this is that there will potentially be chunks which are unlit
with an invalid skymaps, this could have potential implications on plugins which care about
this for checking the highest block in a region, as well as serves to just cause issues with
invalid lighting in chunks which isn't accurately fixed.

There is inherently nothing random about these light updates, they're there to ensure that
the worlds lightmap is properly updated and disabling them only serves to cause sporadic
lighting issues in the world.

diff --git a/src/main/java/net/minecraft/world/WorldServer.java b/src/main/java/net/minecraft/world/WorldServer.java
index d6f052e..aa4de2a 100644
--- a/src/main/java/net/minecraft/world/WorldServer.java
+++ b/src/main/java/net/minecraft/world/WorldServer.java
@@ -481,7 +481,7 @@ public class WorldServer extends World implements IThreadListener {
     protected void playerCheckLight() {
         this.profiler.startSection("playerCheckLight");
 
-        if (this.spigotConfig.randomLightUpdates && !this.playerEntities.isEmpty()) {
+        if (!this.playerEntities.isEmpty()) { // Paper - Remove spigot's randomLightUpdates check
             int i = this.rand.nextInt(this.playerEntities.size());
             EntityPlayer entityhuman = this.playerEntities.get(i);
             int j = MathHelper.floor(entityhuman.posX) + this.rand.nextInt(11) - 5;
diff --git a/src/main/java/net/minecraft/world/chunk/Chunk.java b/src/main/java/net/minecraft/world/chunk/Chunk.java
index 4b40899..1a01f4c 100644
--- a/src/main/java/net/minecraft/world/chunk/Chunk.java
+++ b/src/main/java/net/minecraft/world/chunk/Chunk.java
@@ -1105,7 +1105,7 @@ public class Chunk {
 
         this.ticked = true;
 
-        if (!this.isLightPopulated && this.isTerrainPopulated && this.world.spigotConfig.randomLightUpdates) {
+        if (!this.isLightPopulated && this.isTerrainPopulated) { // Paper - Remove Spigot's randomLightUpdates check
             this.checkLight();
         }
 
-- 
2.14.3.windows.1

