From 5a155f385b10d8d031b8293374f78507a54f304e Mon Sep 17 00:00:00 2001
From: Alfie Cleveland <alfeh@me.com>
Date: Fri, 20 Oct 2017 20:19:22 -0400
Subject: [PATCH] Stricter isDisconnected and isMovementBlocked checks

Credit to prplz for figuring out specifics

diff --git a/src/main/java/net/minecraft/entity/player/EntityPlayerMP.java b/src/main/java/net/minecraft/entity/player/EntityPlayerMP.java
index 32e7bb9..34c04c9 100644
--- a/src/main/java/net/minecraft/entity/player/EntityPlayerMP.java
+++ b/src/main/java/net/minecraft/entity/player/EntityPlayerMP.java
@@ -1550,7 +1550,7 @@ public class EntityPlayerMP extends EntityPlayer implements IContainerListener {
     }
 
     public boolean isMovementBlocked() {
-        return super.isMovementBlocked() || !this.getBukkitEntity().isOnline();
+        return super.isMovementBlocked() || (this.connection != null && this.connection.isDisconnected()); // Paper - Stricter check
     }
 
     public Scoreboard getWorldScoreboard() {
diff --git a/src/main/java/net/minecraft/network/NetHandlerPlayServer.java b/src/main/java/net/minecraft/network/NetHandlerPlayServer.java
index e7ea29d..e1249ac 100644
--- a/src/main/java/net/minecraft/network/NetHandlerPlayServer.java
+++ b/src/main/java/net/minecraft/network/NetHandlerPlayServer.java
@@ -2883,6 +2883,6 @@ public class NetHandlerPlayServer implements INetHandlerPlayServer, ITickable {
     }
 
     public final boolean isDisconnected() {
-        return !this.player.joining && !this.netManager.isChannelOpen();
+        return (!this.player.joining && !this.netManager.isChannelOpen()) || this.processedDisconnect; // Paper - Stricter check
     }
 }
-- 
2.14.2.windows.2

